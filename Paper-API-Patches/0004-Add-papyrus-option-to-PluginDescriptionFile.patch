From a504fd7647b9c22ba2a7579f8f936a7926496e9e Mon Sep 17 00:00:00 2001
From: Indhi Rousseau <contact@thekinrar.fr>
Date: Wed, 15 Jan 2020 02:38:47 +0000
Subject: [PATCH] Add papyrus option to PluginDescriptionFile


diff --git a/src/main/java/org/bukkit/plugin/PluginDescriptionFile.java b/src/main/java/org/bukkit/plugin/PluginDescriptionFile.java
index f78a7df6e..9933dcf5c 100644
--- a/src/main/java/org/bukkit/plugin/PluginDescriptionFile.java
+++ b/src/main/java/org/bukkit/plugin/PluginDescriptionFile.java
@@ -247,6 +247,7 @@ public final class PluginDescriptionFile {
     private PermissionDefault defaultPerm = PermissionDefault.OP;
     private Set<PluginAwareness> awareness = ImmutableSet.of();
     private String apiVersion = null;
+    private boolean papyrus = false;
 
     public PluginDescriptionFile(@NotNull final InputStream stream) throws InvalidDescriptionException {
         loadMap(asMap(YAML.get().load(stream)));
@@ -957,6 +958,10 @@ public final class PluginDescriptionFile {
         return apiVersion;
     }
 
+    public boolean isPapyrus() {
+        return papyrus;
+    }
+
     /**
      * @return unused
      * @deprecated unused
@@ -1136,6 +1141,14 @@ public final class PluginDescriptionFile {
         if (map.get("prefix") != null) {
             prefix = map.get("prefix").toString();
         }
+
+        if (map.get("papyrus") != null) {
+            try {
+                papyrus = (Boolean) map.get("papyrus");
+            } catch (ClassCastException ex) {
+                throw new InvalidDescriptionException(ex, "papyrus has wrong type");
+            }
+        }
     }
 
     @NotNull
@@ -1209,6 +1222,8 @@ public final class PluginDescriptionFile {
             map.put("prefix", prefix);
         }
 
+        map.put("papyrus", papyrus);
+
         return map;
     }
 
diff --git a/src/main/java/org/bukkit/plugin/java/PluginClassLoader.java b/src/main/java/org/bukkit/plugin/java/PluginClassLoader.java
index 6f99f08cb..1cc67ca4e 100644
--- a/src/main/java/org/bukkit/plugin/java/PluginClassLoader.java
+++ b/src/main/java/org/bukkit/plugin/java/PluginClassLoader.java
@@ -18,7 +18,9 @@ import java.util.jar.JarEntry;
 import java.util.jar.JarFile;
 import java.util.jar.Manifest;
 import java.util.logging.Level;
+
 import org.apache.commons.lang.Validate;
+import org.bukkit.Bukkit;
 import org.bukkit.plugin.InvalidPluginException;
 import org.bukkit.plugin.PluginDescriptionFile;
 import org.bukkit.plugin.SimplePluginManager;
-- 
2.30.0

